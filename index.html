<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="玉英博客" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="将来的你，一定会感谢现在拼命努力的自己">
<meta property="og:type" content="website">
<meta property="og:title" content="玉英博客">
<meta property="og:url" content="http://zhangyuki.github.io/index.html">
<meta property="og:site_name" content="玉英博客">
<meta property="og:description" content="将来的你，一定会感谢现在拼命努力的自己">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="玉英博客">
<meta name="twitter:description" content="将来的你，一定会感谢现在拼命努力的自己">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhangyuki.github.io/"/>





  <title>玉英博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">玉英博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">家庭、工作、学习、旅行</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/11/03/网页进度loading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/03/网页进度loading/" itemprop="url">
                  网页进度loading
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-03T09:19:49+08:00">
                2017-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>loading随处可见，比如一个app经常会有下拉刷新，上拉加载的功能，在刷新和加载的过程中为了让用户感知到 load 的过程，我们会使用一些过渡动画来表达。最常见的比如“转圈圈”，“省略号”等等。</p>
<p>网页loading有很多用处，比如页面的加载进度，数据的加载过程等等，数据的加载loading很好做，只需要在加载数据之前（before ajax）显示loading效果，在数据返回之后（ajax completed）结束loading效果，就可以了。</p>
<h3 id="首先准备一段loading的html："><a href="#首先准备一段loading的html：" class="headerlink" title="首先准备一段loading的html："></a>首先准备一段loading的html：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;写一个网页进度loading&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">  &lt;div class=<span class="string">"loading"</span> id=<span class="string">"loading"</span>&gt;</div><div class="line">    &lt;div class=<span class="string">"progress"</span> id=<span class="string">"progress"</span>&gt;0%&lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h3 id="样式装扮一下："><a href="#样式装扮一下：" class="headerlink" title="样式装扮一下："></a>样式装扮一下：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">.loading &#123;</div><div class="line">  display: table;</div><div class="line">  position: fixed;</div><div class="line">  top: 0;</div><div class="line">  left: 0;</div><div class="line">  width: 100%;</div><div class="line">  height: 100%;</div><div class="line">  background-color: <span class="comment">#fff;</span></div><div class="line">  z-index: 5;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">.loading .progress &#123;</div><div class="line">  display: table-cell;</div><div class="line">  vertical-align: middle;</div><div class="line">  text-align: center;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>假设这个loading只需要在页面加载完成之后隐藏，中间不需要显示进度。那么很简单，我们第一时间想到的就是window.onload：</p>
<p>（以下内容为了方便演示，默认使用jQuery，语法有es6的箭头函数）</p>
<p>var $loading = $(‘#loading’)<br>var $progress = $(‘#progress’)</p>
<p>window.onload = () =&gt; {<br>  $loading.hide()<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ok，这样基本的loading流程就有了，增加一个进度的效果，每隔100ms就自增1，一直到100%为止，而另一方面window loaded的时候，把loading给隐藏。</div><div class="line"></div><div class="line">### 补充一下进度：</div><div class="line"></div><div class="line">```bash</div><div class="line">var $loading = $(&apos;#loading&apos;)</div><div class="line">var $progress = $(&apos;#progress&apos;)</div><div class="line">var prg = 0  // 初始化进度</div><div class="line"> </div><div class="line">var timer = window.setInterval(() =&gt; &#123;  // 设置定时器</div><div class="line">  if (prg &gt;= 100) &#123;  // 到达终点，关闭定时器</div><div class="line">    window.clearInterval(timer)</div><div class="line">    prg = 100</div><div class="line">  &#125; else &#123;  // 未到终点，进度自增</div><div class="line">    prg++</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  $progress.html(prg + &apos;%&apos;)</div><div class="line">  console.log(prg)</div><div class="line">&#125;, 100)</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  $loading.hide()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>效果不错，但是有个问题，万一window loaded太慢了，导致进度显示load到100%了，loading还没有隐藏，那就打脸了。所以，需要让loading在window loaded的时候才到达终点，在这之前，loading可以保持一个等待的状态，比如在80%的时候，先停一停，然后在loaded的时候快速将进度推至100%。这个做法是目前绝大部份进度条的做法。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line">var prg = 0</div><div class="line"> </div><div class="line">var timer = window.setInterval(() =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (prg &gt;= 80) &#123;  // 到达第一阶段80%，关闭定时器，保持等待</div><div class="line">    window.clearInterval(timer)</div><div class="line">    prg = 100</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    prg++</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  <span class="variable">$progress</span>.html(prg + <span class="string">'%'</span>)</div><div class="line">  console.log(prg)</div><div class="line">&#125;, 100)</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  window.clearInterval(timer)</div><div class="line">  window.setInterval(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (prg &gt;= 100) &#123;  // 到达终点，关闭定时器</div><div class="line">      window.clearInterval(timer)</div><div class="line">      prg = 100</div><div class="line">      <span class="variable">$loading</span>.hide()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      prg++</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="variable">$progress</span>.html(prg + <span class="string">'%'</span>)</div><div class="line">    console.log(prg)</div><div class="line">  &#125;, 10)  // 时间间隔缩短</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ok，这差不多就是想要的功能了，重复的代码给封装一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line">var prg = 0</div><div class="line"> </div><div class="line">var timer = 0</div><div class="line"> </div><div class="line">progress(80, 100)</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  progress(100, 10, () =&gt; &#123;</div><div class="line">    <span class="variable">$loading</span>.hide()</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> progress (dist, delay, callback) &#123;</div><div class="line">  window.clearInterval(timer)</div><div class="line">  timer = window.setInterval(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (prg &gt;= dist) &#123;</div><div class="line">      window.clearInterval(timer)</div><div class="line">      prg = dist</div><div class="line">      callback &amp;&amp; callback()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      prg++</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="variable">$progress</span>.html(prg + <span class="string">'%'</span>)</div><div class="line">    console.log(prg)</div><div class="line">  &#125;, delay)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>得到了一个progress函数，这个函数就是我们主要的功能模块，通过传入一个目标值、一个时间间隔，就可以模拟进度的演化过程。</p>
<p>目前来看，这个进度还是有些问题的：</p>
<p>进度太平均，相同的时间间隔，相同的增量，不符合网络环境的特点；<br>window.onload太快，还来不及看清100%，loading就已经不见了；<br>每次第一阶段都是在80%就暂停了，露馅儿了；</p>
<p>第一个点，要让时间间隔随机，增量也随机；第二个点很简单，延迟一下就好了；第三点也需要我们随机产生一个初始值。</p>
<p>增量随机很好办，如何让时间间隔随机？setInterval是无法动态设置delay的，那么我们就要把它改造一下，使用setTimeout来实现。（setInterval跟setTimeout的用法和区别就不细说了吧？）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line">var prg = 0</div><div class="line"> </div><div class="line">var timer = 0</div><div class="line"> </div><div class="line">progress([80, 90], [1, 3], 100)  // 使用数组来表示随机数的区间</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  progress(100, [1, 5], 10, () =&gt; &#123;</div><div class="line">    window.setTimeout(() =&gt; &#123;  // 延迟了一秒再隐藏loading</div><div class="line">      <span class="variable">$loading</span>.hide()</div><div class="line">    &#125;, 1000)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> progress (dist, speed, delay, callback) &#123;</div><div class="line">  var _dist = random(dist)</div><div class="line">  var _delay = random(delay)</div><div class="line">  var _speed = random(speed)</div><div class="line">  window.clearTimeout(timer)</div><div class="line">  timer = window.setTimeout(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (prg + _speed &gt;= _dist) &#123;</div><div class="line">      window.clearTimeout(timer)</div><div class="line">      prg = _dist</div><div class="line">      callback &amp;&amp; callback()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      prg += _speed</div><div class="line">      progress (_dist, speed, delay, callback)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="variable">$progress</span>.html(parseInt(prg) + <span class="string">'%'</span>)  // 留意，由于已经不是自增1，所以这里要取整</div><div class="line">    console.log(prg)</div><div class="line">  &#125;, _delay)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> random (n) &#123;</div><div class="line">  <span class="keyword">if</span> (typeof n === <span class="string">'object'</span>) &#123;</div><div class="line">    var <span class="built_in">times</span> = n[1] - n[0]</div><div class="line">    var offset = n[0]</div><div class="line">    <span class="built_in">return</span> Math.random() * <span class="built_in">times</span> + offset</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">return</span> n</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此，差不多完成了需求。</p>
<p>but，还有一个比较隐蔽的问题，现在使用window.onload，发现从进入页面，到window.onload这中间相隔时间十分短，基本是感受不到第一阶段进度（80%）的，如果页面的加载资源数量很多，体积很大的时候，从进入页面，到window.onload就不是这么快速了，这中间可能会很漫长（5～20秒不等），但事实上，首屏资源 的加载争取时间就可以了，不需要等待所有资源就绪，而且更快地呈现页面也是提高用户体验的关键。</p>
<p>应该考虑页面loading停留过久的情况，需要为loading设置一个超时时间，超过这个时间，假设window.onload还没有完成，也要把进度推到100%，把loading结束掉。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line">var prg = 0</div><div class="line"> </div><div class="line">var timer = 0</div><div class="line"> </div><div class="line">progress([80, 90], [1, 3], 100)  // 使用数组来表示随机数的区间</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  progress(100, [1, 5], 10, () =&gt; &#123;</div><div class="line">    window.setTimeout(() =&gt; &#123;  // 延迟了一秒再隐藏loading</div><div class="line">      <span class="variable">$loading</span>.hide()</div><div class="line">    &#125;, 1000)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"> </div><div class="line">window.setTimeout(() =&gt; &#123;  // 设置5秒的超时时间</div><div class="line">  progress(100, [1, 5], 10, () =&gt; &#123;</div><div class="line">    window.setTimeout(() =&gt; &#123;  // 延迟了一秒再隐藏loading</div><div class="line">      <span class="variable">$loading</span>.hide()</div><div class="line">    &#125;, 1000)</div><div class="line">  &#125;)</div><div class="line">&#125;, 5000)</div><div class="line"> </div><div class="line"><span class="keyword">function</span> progress (dist, speed, delay, callback) &#123;</div><div class="line">  var _dist = random(dist)</div><div class="line">  var _delay = random(delay)</div><div class="line">  var _speed = random(speed)</div><div class="line">  window.clearTimeout(timer)</div><div class="line">  timer = window.setTimeout(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (prg + _speed &gt;= _dist) &#123;</div><div class="line">      window.clearTimeout(timer)</div><div class="line">      prg = _dist</div><div class="line">      callback &amp;&amp; callback()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      prg += _speed</div><div class="line">      progress (_dist, speed, delay, callback)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="variable">$progress</span>.html(parseInt(prg) + <span class="string">'%'</span>)  // 留意，由于已经不是自增1，所以这里要取整</div><div class="line">    console.log(prg)</div><div class="line">  &#125;, _delay)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> random (n) &#123;</div><div class="line">  <span class="keyword">if</span> (typeof n === <span class="string">'object'</span>) &#123;</div><div class="line">    var <span class="built_in">times</span> = n[1] - n[0]</div><div class="line">    var offset = n[0]</div><div class="line">    <span class="built_in">return</span> Math.random() * <span class="built_in">times</span> + offset</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">return</span> n</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>直接设置了一个定时器，5s的时间来作为超时时间。这样做是可以的。</p>
<p>but，还是有问题，这个定时器是在js加载完毕之后才开始生效的，也就是说，忽略了js加载完毕之前的时间，这误差可大可小，设置的5s，实际用户可能等待了8s，这是有问题的。我们做用户体验，需要从实际情况去考虑，所以这个开始时间还需要再提前一些，我们在head里来记录这个开始时间，然后在js当中去做对比，如果时间差大于超时时间，那我们就可以直接执行最后的完成步骤，如果小于超时时间，则等待 剩余的时间 过后，再完成进度。</p>
<p>先在head里埋点，记录用户进入页面的时间loadingStartTime：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">  &lt;title&gt;网页进度loading&lt;/title&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">    window.loadingStartTime = new Date()</div><div class="line">  &lt;/script&gt;</div><div class="line">  &lt;script src=<span class="string">"index.js"</span>&gt;&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">  &lt;div class=<span class="string">"loading"</span> id=<span class="string">"loading"</span>&gt;</div><div class="line">    &lt;div class=<span class="string">"progress"</span> id=<span class="string">"progress"</span>&gt;0%&lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>然后，对比 当前的时间 ，看是否超时：（为了方便复用代码，我把完成的部分封装成函数complete）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line">var prg = 0</div><div class="line"> </div><div class="line">var timer = 0</div><div class="line">var now = new Date()  // 记录当前时间</div><div class="line">var timeout = 5000  // 超时时间</div><div class="line"> </div><div class="line">progress([80, 90], [1, 3], 100)</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  complete()</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">if</span> (now - loadingStartTime &gt; timeout) &#123;  // 超时</div><div class="line">  complete()</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  window.setTimeout(() =&gt; &#123;  // 未超时，则等待剩余时间</div><div class="line">    complete()</div><div class="line">  &#125;, timeout - (now - loadingStartTime))</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">complete</span></span> () &#123;  // 封装完成进度功能</div><div class="line">  progress(100, [1, 5], 10, () =&gt; &#123;</div><div class="line">    window.setTimeout(() =&gt; &#123;</div><div class="line">      <span class="variable">$loading</span>.hide()</div><div class="line">    &#125;, 1000)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> progress (dist, speed, delay, callback) &#123;</div><div class="line">  var _dist = random(dist)</div><div class="line">  var _delay = random(delay)</div><div class="line">  var _speed = random(speed)</div><div class="line">  window.clearTimeout(timer)</div><div class="line">  timer = window.setTimeout(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (prg + _speed &gt;= _dist) &#123;</div><div class="line">      window.clearTimeout(timer)</div><div class="line">      prg = _dist</div><div class="line">      callback &amp;&amp; callback()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      prg += _speed</div><div class="line">      progress (_dist, speed, delay, callback)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="variable">$progress</span>.html(parseInt(prg) + <span class="string">'%'</span>)</div><div class="line">    console.log(prg)</div><div class="line">  &#125;, _delay)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> random (n) &#123;</div><div class="line">  <span class="keyword">if</span> (typeof n === <span class="string">'object'</span>) &#123;</div><div class="line">    var <span class="built_in">times</span> = n[1] - n[0]</div><div class="line">    var offset = n[0]</div><div class="line">    <span class="built_in">return</span> Math.random() * <span class="built_in">times</span> + offset</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">return</span> n</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完整地实现了这一功能。</p>
<p>如果目的是为了写一个纯粹障眼法的伪loading，那跟其他loading的实现就没什么区别了，我们做事讲究脚踏实地，能实现的实现，不能实现的，为了团队和谐，我们不得已坑蒙拐骗。那么我们还能更贴近实际情况一点吗？其实是可以的。</p>
<p>来分析一个场景，假设让loading更加真实一些，那么可以选择性地对页面上几个比较大的资源的加载进行跟踪，然后拆分整个进度条，比如页面有三张大图a、b、c，那么将进度条拆成五段，每加载完一张图就推进一个进度：</p>
<p>随机初始化[10, 20] -&gt;<br>图a推进20%的进度 -&gt;<br>图b推进25%的进度 -&gt;<br>图c推进30%的进度 -&gt;<br>完成100%</p>
<p>这三张图要占20% + 25% + 30% = 75%的进度。</p>
<p>问题是，如果图片加载完成是按照顺序来的，那可以很简单地：10（假设初始进度是10%） -&gt; 30 -&gt; 55 -&gt; 85 -&gt; 100，但事实是，图片不会按照顺序来，谁早到谁晚到是说不准的，所以需要更合理的方式去管理这些进度增量，使它们不会互相覆盖。</p>
<p>需要一个能够累计增量的变量next；<br>由于progress都是传目的进度的，需要另外一个函数add，来传增量进度。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line">var prg = 0</div><div class="line"> </div><div class="line">var timer = 0</div><div class="line">var now = new Date()</div><div class="line">var timeout = 5000</div><div class="line"> </div><div class="line">var next = prg</div><div class="line"> </div><div class="line">add([30, 50], [1, 3], 100)  // 第一阶段</div><div class="line"> </div><div class="line">window.setTimeout(() =&gt; &#123;  // 模拟图a加载完</div><div class="line">  add(20, [1, 3], 200)</div><div class="line">&#125;, 1000)</div><div class="line"> </div><div class="line">window.setTimeout(() =&gt; &#123;  // 模拟图c加载完</div><div class="line">  add(30, [1, 3], 200)</div><div class="line">&#125;, 2000)</div><div class="line"> </div><div class="line">window.setTimeout(() =&gt; &#123;  // 模拟图b加载完</div><div class="line">  add(25, [1, 3], 200)</div><div class="line">&#125;, 2500)</div><div class="line"> </div><div class="line">window.onload = () =&gt; &#123;</div><div class="line">  complete()</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">if</span> (now - loadingStartTime &gt; timeout) &#123;</div><div class="line">  complete()</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  window.setTimeout(() =&gt; &#123;</div><div class="line">    complete()</div><div class="line">  &#125;, timeout - (now - loadingStartTime))</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">complete</span></span> () &#123;</div><div class="line">  add(100, [1, 5], 10, () =&gt; &#123;</div><div class="line">    window.setTimeout(() =&gt; &#123;</div><div class="line">      <span class="variable">$loading</span>.hide()</div><div class="line">    &#125;, 1000)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> add (dist, speed, delay, callback) &#123;</div><div class="line">  var _dist = random(dist)</div><div class="line">  <span class="keyword">if</span> (next + _dist &gt; 100) &#123;  // 对超出部分裁剪对齐</div><div class="line">    next = 100</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    next += _dist</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  progress(next, speed, delay, callback)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> progress (dist, speed, delay, callback) &#123;</div><div class="line">  var _delay = random(delay)</div><div class="line">  var _speed = random(speed)</div><div class="line">  window.clearTimeout(timer)</div><div class="line">  timer = window.setTimeout(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (prg + _speed &gt;= dist) &#123;</div><div class="line">      window.clearTimeout(timer)</div><div class="line">      prg = dist</div><div class="line">      callback &amp;&amp; callback()</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      prg += _speed</div><div class="line">      progress (dist, speed, delay, callback)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="variable">$progress</span>.html(parseInt(prg) + <span class="string">'%'</span>)</div><div class="line">    console.log(prg)</div><div class="line">  &#125;, _delay)</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">function</span> random (n) &#123;</div><div class="line">  <span class="keyword">if</span> (typeof n === <span class="string">'object'</span>) &#123;</div><div class="line">    var <span class="built_in">times</span> = n[1] - n[0]</div><div class="line">    var offset = n[0]</div><div class="line">    <span class="built_in">return</span> Math.random() * <span class="built_in">times</span> + offset</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">return</span> n</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用setTimeout来模拟图片的加载，真实应用应该是使用image.onload。</p>
<p>以上，一步步实现一个进度loading的过程了，演示代码可以戳codePen 写一个网页进度loading。</p>
<p>看似很简单的一个功能，其实仔细推敲，还是有很多细节要考虑的。</p>
<p>到这里，其实真的已经完成了，</p>
<p>实现这个功能非常简单：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var Progress = require(<span class="string">'ez-progress'</span>)</div><div class="line">var prg = new Progress()</div><div class="line"> </div><div class="line">var <span class="variable">$loading</span> = $(<span class="string">'#loading'</span>)</div><div class="line">var <span class="variable">$progress</span> = $(<span class="string">'#progress'</span>)</div><div class="line"> </div><div class="line">prg.on(<span class="string">'progress'</span>, <span class="keyword">function</span> (res) &#123;</div><div class="line">  var progress = parseInt(res.progress)  // 注意进度取整，不然有可能会出现小数</div><div class="line">  <span class="variable">$progress</span>.html(progress + <span class="string">'%'</span>)</div><div class="line">&#125;)</div><div class="line"> </div><div class="line">prg.go([60, 70], <span class="keyword">function</span> (res) &#123;</div><div class="line">  prg.complete(null, [0, 5], [0, 50])  // 飞一般地冲向终点</div><div class="line">&#125;, [0, 3], [0, 200])</div><div class="line"> </div><div class="line">window.onload = <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">  prg.complete(null, [0, 5], [0, 50])  // 飞一般地冲向终点</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>木油错，94这么简单！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/10/12/前端项目操作vue指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/12/前端项目操作vue指南/" itemprop="url">
                  前端项目操作vue指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-12T17:37:04+08:00">
                2017-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="下载Git：https-git-scm-com-downloads"><a href="#下载Git：https-git-scm-com-downloads" class="headerlink" title="下载Git：https://git-scm.com/downloads"></a>下载Git：<a href="https://git-scm.com/downloads" target="_blank" rel="external">https://git-scm.com/downloads</a></h4><h4 id="下载Node：https-nodejs-org-en-download"><a href="#下载Node：https-nodejs-org-en-download" class="headerlink" title="下载Node：https://nodejs.org/en/download/"></a>下载Node：<a href="https://nodejs.org/en/download/" target="_blank" rel="external">https://nodejs.org/en/download/</a></h4><h4 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> http://gitlab.odc.com/FE-Projects/wuxi-zhigu.git</div><div class="line"><span class="built_in">cd</span>/FE-Projects</div><div class="line">npm install </div><div class="line">npm install cooking-cli -g</div><div class="line">cooking watch -p // 启动项目</div><div class="line">cooking build -p // 打包项目</div></pre></td></tr></table></figure>
<h4 id="项目开发说明"><a href="#项目开发说明" class="headerlink" title="项目开发说明"></a>项目开发说明</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">代码说明：</div><div class="line">&lt;script&gt;</div><div class="line">import .. from ..;  //引入组件以及其他插件</div><div class="line"><span class="built_in">export</span> default &#123;</div><div class="line">  component:&#123;</div><div class="line">    // 注册引入的组件，插件无需注册</div><div class="line">  &#125;,</div><div class="line">  <span class="function"><span class="title">data</span></span>()&#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">      obj:&#123;&#125;,</div><div class="line">      number:0</div><div class="line">      // template中所引用的数据</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  methods:&#123; // 页面中需要用到的方法</div><div class="line">    <span class="function"><span class="title">handleDosomething</span></span>()&#123;</div><div class="line">      // 自定义方法</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="function"><span class="title">created</span></span>()&#123;</div><div class="line">    this.handleDosomething(); // 调用方法</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<h4 id="参考资料汇总："><a href="#参考资料汇总：" class="headerlink" title="参考资料汇总："></a>参考资料汇总：</h4><p>vue语法：<a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="external">https://cn.vuejs.org/v2/guide/</a><br>路由定义：<a href="https://router.vuejs.org/zh-cn/" target="_blank" rel="external">https://router.vuejs.org/zh-cn/</a><br>UI框架使用指南：<a href="http://element.eleme.io/#/zh-CN/component/installation" target="_blank" rel="external">http://element.eleme.io/#/zh-CN/component/installation</a><br>构建工具使用说明：<a href="http://cookingjs.github.io/zh-cn/index.html" target="_blank" rel="external">http://cookingjs.github.io/zh-cn/index.html</a><br>git使用指南：<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/" target="_blank" rel="external">http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/09/09/react性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/09/react性能优化/" itemprop="url">
                  react性能优化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T13:32:37+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>React是一个专注于UI层的框架，它使用虚拟DOM技术，以保证它UI的高速渲染；使用单向数据流，因此它数据绑定更加简单；<br>那么它内部是如何保持简单高效的UI渲染呢？这种渲染机制有可能存在什么性能问题呢？</p>
<h4 id="React组件渲染问题引出"><a href="#React组件渲染问题引出" class="headerlink" title="React组件渲染问题引出"></a>React组件渲染问题引出</h4><p>React不直接操作DOM，它在内存中维护一个快速响应的DOM描述，render方法返回一个DOM的描述，<br>React能够计算出两个DOM描述的差异，然后更新浏览器中的DOM。这就是著名的DOM Diff。</p>
<p>就是说React在接收到属性(props)或者状态(state)更新时，就会更新UI。所以React整个UI渲染是比较快的。但是这里面可能出现的问题是：</p>
<p>假设我们定义一个父组件，其包含了5000个子组件。我们有一个输入框输入操作，每次输入一个数字，对应的那个子组件背景色变红。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;Components&gt;</div><div class="line">  &lt;Components-1 /&gt;</div><div class="line">  &lt;Components-2 /&gt;</div><div class="line">  &lt;Components-3 /&gt;</div><div class="line">  ...</div><div class="line">  &lt;Components-5000 /&gt;</div><div class="line">&lt;/Components&gt;</div></pre></td></tr></table></figure>
<p>这样我们输入数字1，则子组件1背景色变化，但是在这个过程中，所有的子组件都进行了重新渲染，导致整体渲染变慢。<br>造成这种现象的原因是 React中父组件更新默认触发所有子组件更新。</p>
<p>同时，我们经常在遍历列表元素时候会遇到这样的提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Warning: Each child <span class="keyword">in</span> an array or iterator should have a unique <span class="string">"key"</span> prop.</div></pre></td></tr></table></figure>
<p>这就是我们今天要讨论的两个性能优化点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">父组件更新默认触发所有子组件更新</div><div class="line">列表类型的组件默认更新方式非常复杂</div></pre></td></tr></table></figure>
<h4 id="React性能检测工具"><a href="#React性能检测工具" class="headerlink" title="React性能检测工具"></a>React性能检测工具</h4><p>安装 react 性能检测工具 npm i react-addons-perf –save，然后在./app/index.jsx中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 性能测试 </div><div class="line">import Perf from <span class="string">'react-addons-perf'</span> </div><div class="line"><span class="keyword">if</span> (__DEV__) &#123; </div><div class="line">	window.Perf = Perf </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>检测方法，在浏览器控制台输入如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">开始记录：Perf.start()</div><div class="line">结束记录：Perf.stop()</div><div class="line">打印结果：<span class="built_in">print</span>Inclusive()</div></pre></td></tr></table></figure>
<p>运行程序。在操作之前先运行Perf.start()开始检测，<br>然后进行若干操作，运行Perf.stop停止检测，<br>然后再运行Perf.printWasted()即可打印出浪费性能的组件列表。<br>在项目开发过程中，要经常使用检测工具来看看性能是否正常。</p>
<p>如果性能的影响不是很大，例如每次操作多浪费几毫秒、十几毫秒，个人以为没必要深究，但是如果浪费过多影响了用户体验，就必须去搞定它。</p>
<h4 id="PureRenderMixin-优化"><a href="#PureRenderMixin-优化" class="headerlink" title="PureRenderMixin 优化"></a>PureRenderMixin 优化</h4><p>React 最基本的优化方式是使用PureRenderMixin，<br>安装工具 npm i react-addons-pure-render-mixin –save，然后在组件中引用并使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-addons-pure-render-mixin --save</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">import React from <span class="string">'react'</span> </div><div class="line">import PureRenderMixin from <span class="string">'react-addons-pure-render-mixin'</span> </div><div class="line">class List extends React.Component &#123; </div><div class="line">	constructor(props, context) &#123; </div><div class="line">		super(props, context); </div><div class="line">		this.shouldComponentUpdate = PureRenderMixin.shouldComponentUpdate.bind(this); </div><div class="line">	&#125; </div><div class="line">	//其原理就是重写了 shouldComponentUpdate 方法。</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>React 有一个生命周期 hook 叫做shouldComponentUpdate，<br>组件每次更新之前，都要过一遍这个函数，如果这个函数返回true则更新，如果返回false则不更新。<br>而默认情况下，这个函数会一直返回true，就是说，如果有一些无效的改动触发了这个函数，也会导致无效的更新<br>那么什么是无效的改动？之前说过，组件中的props和state一旦变化会导致组件重新更新并渲染，<br>但是如果props和state没有变化也莫名其妙的触发更新了呢（这种情况确实存在）———— 这不就导致了无效渲染吗？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">这里使用</div><div class="line">this.shouldComponentUpdate = PureRenderMixin.shouldComponentUpdate.bind(this);</div><div class="line">的意思是重写组件的shouldComponentUpdate函数，</div><div class="line">在每次更新之前判断props和state，如果有变化则返回<span class="literal">true</span>，无变化则返回<span class="literal">false</span>。</div></pre></td></tr></table></figure>
<p>因此，我们在开发过程中，在每个 React 组件中都尽量使用PureRenderMixin</p>
<h4 id="PureComponent"><a href="#PureComponent" class="headerlink" title="PureComponent"></a>PureComponent</h4><p>React 15.3.0 新增了一个 PureComponent 类，<br>以 ES2015 class 的方式方便地定义纯组件 (pure component)，用于取代之前的 PureRenderMixin。</p>
<p>这个类的用法很简单，如果你有些组件是纯组件，那么把继承类从 Component 换成 PureComponent 即可。<br>当组件更新时，如果组件的 props 和 state 都没发生改变，render 方法就不会触发，<br>省去 Virtual DOM 的生成和比对过程，达到提升性能的目的。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import React, &#123; PureComponent &#125; from <span class="string">'react'</span></div><div class="line">class Example extends PureComponent &#123;</div><div class="line">  <span class="function"><span class="title">render</span></span>() &#123;</div><div class="line">    // ...</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>虽然React提供了Virtual DOM DOM Diff 等优秀的能力来提高渲染性能，但是在实际使用过程中，我们经常会遇到父组件更新，<br>不需要更新所以子组件的场景（分页），此时必须考虑利用React本周的渲染机制来进行优化。</p>
<h3 id="相关代码-https-github-com-younth-react-tutorial-tree-master-E6-80-A7-E8-83-BD-E8-B0-83-E4-BC-98"><a href="#相关代码-https-github-com-younth-react-tutorial-tree-master-E6-80-A7-E8-83-BD-E8-B0-83-E4-BC-98" class="headerlink" title="相关代码:https://github.com/younth/react-tutorial/tree/master/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"></a>相关代码:<a href="https://github.com/younth/react-tutorial/tree/master/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98" target="_blank" rel="external">https://github.com/younth/react-tutorial/tree/master/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98</a></h3><h4 id="避免更新Demo"><a href="#避免更新Demo" class="headerlink" title="避免更新Demo"></a>避免更新Demo</h4><p>React 使用虚拟 DOM，它是在浏览器中的 DOM 子树的渲染描述，这个平行的描述让 React 避免创建和操作 DOM 节点，<br>这些远比操作一个 JavaScript 对象慢。当一个组件的 props 或 state 改变，<br>React 会构造一个新的虚拟 DOM 和旧的进行对比来决定真实 DOM 更新的必要性，<br>只有在它们不相等的时候，React 才会使用尽量少的改动更新 DOM。<br>在此之上，React 提供了生命周期函数 shouldComponentUpdate，<br>在重新渲染机制回路（虚拟 DOM 对比和 DOM 更新）之前会被触发，赋予开发者跳过这个过程的能力。这个函数默认返回 true，让 React 执行更新。<br>shouldComponentUpdate (nextProps, nextState) {<br>  return true;<br>}<br>返回true时就会调用componentDidUpdata() {</p>
<p>}<br>切住，React 会非常频繁的调用这个函数shouldComponentUpdate(){}，所以要确保它的执行速度够快。</p>
<p>假如你有个带有多个对话的消息应用，如果只有一个对话发生改变，如果我们在 ChatThread 组件执行 shouldComponentUpdate，React 可以跳过其他对话的重新渲染步骤。<br>我们可以简单的实现 shouldComponentUpdate 如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">shouldComponentUpdate (nextProps, nextState) &#123;</div><div class="line">  <span class="built_in">return</span> this.props.value !== nextProps.value;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/09/06/富文本编辑器使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/06/富文本编辑器使用/" itemprop="url">
                  wangEditor 轻量级web富文本框 http://wangEditor.github.io/
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-06T22:09:56+08:00">
                2017-09-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="wangEditor-——-轻量级-web-富文本编辑器，配置方便，使用简单。支持-IE10-浏览器"><a href="#wangEditor-——-轻量级-web-富文本编辑器，配置方便，使用简单。支持-IE10-浏览器" class="headerlink" title="wangEditor —— 轻量级 web 富文本编辑器，配置方便，使用简单。支持 IE10+ 浏览器"></a>wangEditor —— 轻量级 web 富文本编辑器，配置方便，使用简单。支持 IE10+ 浏览器</h4><p>官网：www.wangEditor.com<br>文档：www.kancloud.cn/wangfupeng/wangeditor3/332599<br>源码：github.com/wangfupeng1988/wangEditor </p>
<p>直接下载：<a href="https://github.com/wangfupeng1988/wangEditor/releases" target="_blank" rel="external">https://github.com/wangfupeng1988/wangEditor/releases</a><br>使用npm下载：npm install wangeditor （注意 wangeditor 全部是小写字母）<br>使用bower下载：bower install wangEditor （前提保证电脑已安装了bower）<br>使用CDN：//unpkg.com/wangeditor/release/wangEditor.min.js</p>
<h4 id="demo-运行"><a href="#demo-运行" class="headerlink" title="demo 运行"></a>demo 运行</h4><p>下载源码 git clone git@github.com:wangfupeng1988/wangEditor.git<br>安装或者升级最新版本 node（最低v6.x.x）<br>进入目录，安装依赖包 cd wangEditor &amp;&amp; npm i<br>安装包完成之后，windows 用户运行npm run win-example，Mac 用户运行npm run example<br>打开浏览器访问localhost:3000/index.html<br>用于 React、vue 或者 angular 可查阅文档中其他章节中的相关介绍</p>
<p>项目的根目录下安装 npm install wangeditor || npm install –save wangeditor<br>node_modle 下查看 wangeditor 是否安装成功， </p>
<p>成功安装即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import E from <span class="string">'wangeditor'</span>;</div></pre></td></tr></table></figure></p>
<h4 id="初始化项目：本项目用vue"><a href="#初始化项目：本项目用vue" class="headerlink" title="初始化项目：本项目用vue"></a>初始化项目：本项目用vue</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">this.editList = new E(<span class="string">'#div3'</span>);</div><div class="line">this.editList.customConfig.showLinkImg = <span class="literal">true</span>;</div><div class="line">this.editList.customConfig.uploadImgServer = <span class="string">'/upload'</span>; // 上传图片设置后端服务器</div><div class="line">this.editList.create();</div></pre></td></tr></table></figure>
<h4 id="读取内容-可以html和text的方式读取编辑器的内容-详情见说明文档：-https-www-kancloud-cn-wangfupeng-wangeditor3-335775"><a href="#读取内容-可以html和text的方式读取编辑器的内容-详情见说明文档：-https-www-kancloud-cn-wangfupeng-wangeditor3-335775" class="headerlink" title="读取内容 可以html和text的方式读取编辑器的内容,详情见说明文档： https://www.kancloud.cn/wangfupeng/wangeditor3/335775"></a>读取内容 可以html和text的方式读取编辑器的内容,详情见说明文档： <a href="https://www.kancloud.cn/wangfupeng/wangeditor3/335775" target="_blank" rel="external">https://www.kancloud.cn/wangfupeng/wangeditor3/335775</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;div id=<span class="string">"div1"</span>&gt;</div><div class="line">    &lt;p&gt;欢迎使用 wangEditor 编辑器&lt;/p&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;button id=<span class="string">"btn1"</span>&gt;获取html&lt;/button&gt;</div><div class="line">&lt;button id=<span class="string">"btn2"</span>&gt;获取text&lt;/button&gt;</div><div class="line"></div><div class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span> src=<span class="string">"/wangEditor.min.js"</span>&gt;&lt;/script&gt;</div><div class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    var E = window.wangEditor</div><div class="line">    var editor = new E(<span class="string">'#div1'</span>)</div><div class="line">    editor.create()</div><div class="line">    // 读取 html</div><div class="line">    document.getElementById(<span class="string">'btn1'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">        alert(editor.txt.html())</div><div class="line">    &#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">    // 读取 text</div><div class="line">    document.getElementById(<span class="string">'btn2'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">        alert(editor.txt.text())</div><div class="line">    &#125;, <span class="literal">false</span>)</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/09/05/webpack 入门指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/05/webpack 入门指南/" itemprop="url">
                  webpack + React 开发环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-05T09:41:24+08:00">
                2017-09-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="什么是-webpack？"><a href="#什么是-webpack？" class="headerlink" title="什么是 webpack？"></a>什么是 webpack？</h4><p>webpack是近期最火的一款模块加载器兼打包工具，它能把各种资源，例如JS（含JSX）、coffee、样式（含less/sass）、图片等都作为模块来使用和处理。<br>我们可以直接使用 require(XXX) 的形式来引入各模块，即使它们可能需要经过编译（比如JSX和sass），但我们无须在上面花费太多心思，因为 webpack 有着各种健全的加载器（loader）在默默处理这些事情，因为以近期 Github 上各大主流的（React相关）项目来说，它们仓库上所展示的示例已经是基于 webpack 来开发的，比如 React-Bootstrap 和 Redux链接：<a href="https://github.com/gaearon/redux" target="_blank" rel="external">https://github.com/gaearon/redux</a><br>webpack的官网是 <a href="http://webpack.github.io/" target="_blank" rel="external">http://webpack.github.io/</a> ，文档地址是 <a href="http://webpack.github.io/docs/" target="_blank" rel="external">http://webpack.github.io/docs/</a> ，想对其进行更详细了解的可以点进去瞧一瞧。</p>
<p>webpack 的优势</p>
<p>其优势主要可以归类为如下几个：</p>
<ol>
<li><p>webpack 是以 commonJS 的形式来书写脚本，但对 AMD/CMD 的支持也很全面，方便旧项目进行代码迁移。</p>
</li>
<li><p>能被模块化的不仅仅是 JS 了。</p>
</li>
<li><p>开发便捷，能替代部分 grunt/gulp 的工作，比如打包、压缩混淆、图片转base64等。</p>
</li>
<li><p>扩展性强，插件机制完善，特别是支持 React 热插拔（见 react-hot-loader ）的功能让人眼前一亮。</p>
</li>
</ol>
<h4 id="我们谈谈第一点。以-AMD-CMD-模式来说，鉴于模块是异步加载的，所以我们常规需要使用-define-函数来帮我们搞回调："><a href="#我们谈谈第一点。以-AMD-CMD-模式来说，鉴于模块是异步加载的，所以我们常规需要使用-define-函数来帮我们搞回调：" class="headerlink" title="我们谈谈第一点。以 AMD/CMD 模式来说，鉴于模块是异步加载的，所以我们常规需要使用 define 函数来帮我们搞回调："></a>我们谈谈第一点。以 AMD/CMD 模式来说，鉴于模块是异步加载的，所以我们常规需要使用 define 函数来帮我们搞回调：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">define([<span class="string">'package/lib'</span>], <span class="keyword">function</span>(lib)&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">function</span> <span class="function"><span class="title">foo</span></span>()&#123;</div><div class="line">        lib.log(<span class="string">'hello world!'</span>);</div><div class="line">    &#125; </div><div class="line"> </div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        foo: foo</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="另外为了可以兼容-commonJS-的写法，我们也可以将-define-这么写："><a href="#另外为了可以兼容-commonJS-的写法，我们也可以将-define-这么写：" class="headerlink" title="另外为了可以兼容 commonJS 的写法，我们也可以将 define 这么写："></a>另外为了可以兼容 commonJS 的写法，我们也可以将 define 这么写：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">define(<span class="keyword">function</span> (require, exports, module)&#123;</div><div class="line">    var someModule = require(<span class="string">"someModule"</span>);</div><div class="line">    var anotherModule = require(<span class="string">"anotherModule"</span>);    </div><div class="line"></div><div class="line">    someModule.doTehAwesome();</div><div class="line">    anotherModule.doMoarAwesome();</div><div class="line"></div><div class="line">    exports.asplode = <span class="function"><span class="title">function</span></span> ()&#123;</div><div class="line">        someModule.doTehAwesome();</div><div class="line">        anotherModule.doMoarAwesome();</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="然而对-webpack-来说，我们可以直接在上面书写-commonJS-形式的语法，无须任何-define-（毕竟最终模块都打包在一起，webpack-也会最终自动加上自己的加载器）："><a href="#然而对-webpack-来说，我们可以直接在上面书写-commonJS-形式的语法，无须任何-define-（毕竟最终模块都打包在一起，webpack-也会最终自动加上自己的加载器）：" class="headerlink" title="然而对 webpack 来说，我们可以直接在上面书写 commonJS 形式的语法，无须任何 define （毕竟最终模块都打包在一起，webpack 也会最终自动加上自己的加载器）："></a>然而对 webpack 来说，我们可以直接在上面书写 commonJS 形式的语法，无须任何 define （毕竟最终模块都打包在一起，webpack 也会最终自动加上自己的加载器）：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var someModule = require(<span class="string">"someModule"</span>);</div><div class="line">    var anotherModule = require(<span class="string">"anotherModule"</span>);    </div><div class="line"></div><div class="line">    someModule.doTehAwesome();</div><div class="line">    anotherModule.doMoarAwesome();</div><div class="line"></div><div class="line">    exports.asplode = <span class="function"><span class="title">function</span></span> ()&#123;</div><div class="line">        someModule.doTehAwesome();</div><div class="line">        anotherModule.doMoarAwesome();</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<p>即使你保留了之前 define 的写法也是可以滴，毕竟 webpack 的兼容性相当出色，方便你旧项目的模块直接迁移过来。</p>
<h4 id="安装和配置"><a href="#安装和配置" class="headerlink" title="安装和配置"></a>安装和配置</h4><h4 id="一-安装"><a href="#一-安装" class="headerlink" title="一. 安装"></a>一. 安装</h4><p>我们常规直接使用 npm 的形式来安装：<br>初始化 npm 环境<br>首先保证有 node 和 npm 环境，运行node -v和npm -v查看<br>进入项目目录，运行npm init按照步骤填写最终生成package.json文件，所有使用 npm 做依赖管理的项目，根目录下都会有一个这个文件，该文件描述了项目的基本信息以及一些第三方依赖项（插件）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install webpack webpack-dev-server --save-dev</div><div class="line">$ npm i react react-dom --save</div></pre></td></tr></table></figure>
<p>安装完成之后，查看package.json可看到多了 devDependencies 和 dependencies 两项，根目录也多了一个node_modules文件夹。</p>
<h4 id="–save-和-–save-dev-的区别"><a href="#–save-和-–save-dev-的区别" class="headerlink" title="–save 和 –save-dev 的区别"></a>–save 和 –save-dev 的区别</h4><p>npm i时使用–save和–save-dev，可分别将依赖（插件）记录到package.json中的dependencies和devDependencies下面。<br>dependencies下记录的是项目在运行时必须依赖的插件，<br>常见的例如react jquery等，即及时项目打包好了、上线了，这些也是需要用的，否则程序无法正常执行。</p>
<p>devDependencies下记录的是项目在开发过程中使用的插件，<br>例如这里我们开发过程中需要使用webpack打包，而我在工作中使用fis3打包，但是一旦项目打包发布、上线了之后，webpack和fis3就都没有用了，可卸磨杀驴。</p>
<p>延伸一下，我们的项目有package.json，其他我们用的项目如webpack也有package.json，<br>见./node_modules/webpack/package.json，其中也有devDependencies和dependencies。<br>当我们使用npm i webpack时，<br>./node_modules/webpack/package.json中的dependencies会被 npm 安装上，而devDependencies也没必要安装。</p>
<h4 id="配置-webpack-config-js"><a href="#配置-webpack-config-js" class="headerlink" title="配置 webpack.config.js"></a>配置 webpack.config.js</h4><p>为了提高学习效率，webpack最最基础的用法，webpack.config.js这个配置文件详细的讲解一下，</p>
<h4 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h4><p>webpack.config.js 就是一个普通的 js 文件，符合 commonJS 规范。最后输出一个对象，即module.exports = {…}</p>
<h4 id="输入-amp-输出"><a href="#输入-amp-输出" class="headerlink" title="输入 &amp; 输出"></a>输入 &amp; 输出</h4><p>这个比较基础，不过需要新建./app/index.jsx作为入口文件，目前项目中只有这一个入口文件。不过 webpack 支持多个入口文件，可查阅文档。<br>输出就是一个bundle.js，js 和 css 都在里面，不过只有在开发环境下才用，发布代码的时候，肯定不能只有这么一个文件，接下来会讲到。</p>
<h4 id="module"><a href="#module" class="headerlink" title="module"></a>module</h4><p>针对不同类型的文件，使用不同的loader，当然使用之前要安装，<br>例如npm i style-loader css-loader –save-dev。该项目代码中，我们用到的文件格式有：js/jsx 代码、css/less 代码、图片、字体文件。<br>less 是 css 的语法糖，可以更高效低冗余的写 css，不熟悉的朋友可去官网看看，非常简单。<br>在加载 css/less 时用到了postcss，主要使用autoprefixer功能，帮助自动加 css3 的浏览器前缀，非常好用。<br>编译 es6 和 jsx 语法时，用到家喻户晓的babel，另外还需增加一个.babelrc的配置文件。</p>
<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p>使用 html 模板（需要npm i html-webpack-plugin –save-dev），这样可以将输出的文件名（如./bundle.js）自动注入到 html 中，不用我们自己手写。手写的话，一旦修改就需要改两个地方。<br>使用热加载和自动打开浏览器插件</p>
<h4 id="devServer"><a href="#devServer" class="headerlink" title="devServer"></a>devServer</h4><p>对 webpack-dev-server 的配置</p>
<h4 id="npm-start"><a href="#npm-start" class="headerlink" title="npm start"></a>npm start</h4><p>在 package.json 中，输入以下代码，将这一串命令封装为npm start，这样就可以运行项目代码了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"start"</span>: <span class="string">"NODE_ENV=dev webpack-dev-server --progress --colors"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码中NODE_ENV=dev代表当前是开发环境下，这里的”dev”可被 js 代码中的process.env.NODE_ENV得到并做一些其他处理。<br>定义环境全局变量<br>以下定义，可使得代码通过<strong>DEV</strong>得到当前是不是开发模式。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">new webpack.DefinePlugin(&#123;</div><div class="line">  __DEV__: JSON.stringify(JSON.parse((process.env.NODE_ENV == <span class="string">'dev'</span>) || <span class="string">'false'</span>))</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>打开./app/util/localStore.js可以看到if (<strong>DEV</strong>) { console.error(‘localStorage.getItem报错, ‘, ex.message) }，即只有开发环境下才提示error，发布之后就不会提示了。（因为发布的命令中用到NODE_ENV=production）</p>
<h4 id="配置-webpack-production-config-js"><a href="#配置-webpack-production-config-js" class="headerlink" title="配置 webpack.production.config.js"></a>配置 webpack.production.config.js</h4><p>开发环境下，可以不用考虑系统的性能，更多考虑的是如何增加开发效率。而发布系统时，就需要考虑发布之后的系统的性能，包括加载速度、缓存等。下面介绍发布用配置代码和开发用的不一样的地方。<br>发布到 ./build 文件夹中<br>path: __dirname + “/build”,</p>
<h4 id="vendor"><a href="#vendor" class="headerlink" title="vendor"></a>vendor</h4><p>将第三方依赖单独打包。即将 node_modules 文件夹中的代码打包为 vendor.js 将我们自己写的业务代码打包为 app.js。这样有助于缓存，因为在项目维护过程中，第三方依赖不经常变化，而业务代码会经常变化。</p>
<h4 id="md5后缀"><a href="#md5后缀" class="headerlink" title="md5后缀"></a>md5后缀</h4><p>为每个打包出来的文件都加md5后缀，例如”/js/[name].[chunkhash:8].js”，可使文件强缓存。<br>分目录<br>打包出来的不同类型的文件，放在不同目录下，例如图片文件将放在img/目录下</p>
<h4 id="Copyright"><a href="#Copyright" class="headerlink" title="Copyright"></a>Copyright</h4><p>自动为打包出来的代码增加 copyright 内容</p>
<h4 id="分模块"><a href="#分模块" class="headerlink" title="分模块"></a>分模块</h4><p>new webpack.optimize.OccurenceOrderPlugin(),</p>
<h4 id="压缩代码"><a href="#压缩代码" class="headerlink" title="压缩代码"></a>压缩代码</h4><p>使用 Uglify 压缩代码，其中warnings: false是去掉代码中的 warning<br>分离 css 和 js 文件<br>开发环境下，css 代码是放在整个打包出来的那个 bundle.js 文件中的，发布环境下当然不能混淆在一起，使用new ExtractTextPlugin(‘/css/[name].[chunkhash:8].css’),将 css 代码分离出来。<br>npm run build<br>打开package.json，查看以下代码。npm start和npm run build分别是运行代码和打包项目。另外，”start”、”test”可以不用run。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line"><span class="string">"start"</span>: <span class="string">"NODE_ENV=dev webpack-dev-server --progress --colors"</span>,</div><div class="line"><span class="string">"build"</span>: <span class="string">"rm -rf ./build &amp;&amp; NODE_ENV=production webpack --config ./webpack.production.config.js --progress --colors"</span></div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>这两个命令主要有以下区别：<br>前者中默认使用 webpack.config.js 作为配置文件，而后者中强制使用 webpack.production.config.js 作为配置文件<br>前者NODE_ENV=dev而后者NODE_ENV=production，标识不同的环境。而这个”dev” “production”可以在代码中通过process.env.NODE_ENV获取。<br>最小化压缩 React<br>以下配置可以告诉 React 当前是生产环境，请最小化压缩 js ，即把开发环境中的一些提示、警告、判断通通去掉，直流以下发布之后可用的代码。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">new webpack.DefinePlugin(&#123;</div><div class="line">  <span class="string">'process.env'</span>:&#123;</div><div class="line">    <span class="string">'NODE_ENV'</span>: JSON.stringify(process.env.NODE_ENV)</div><div class="line">  &#125;</div><div class="line">&#125;),</div></pre></td></tr></table></figure></p>
<h4 id="二-配置"><a href="#二-配置" class="headerlink" title="二. 配置"></a>二. 配置</h4><p>每个项目下都必须配置有一个 webpack.config.js ，它的作用如同常规的 gulpfile.js/Gruntfile.js ，就是一个配置项，告诉 webpack 它需要做什么。</p>
<p>我们看看下方的示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">var webpack = require(<span class="string">'webpack'</span>);</div><div class="line">var commonsPlugin = new webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">    //插件项</div><div class="line">    plugins: [commonsPlugin],</div><div class="line">    //页面入口文件配置</div><div class="line">    entry: &#123;</div><div class="line">        index : <span class="string">'./src/js/page/index.js'</span></div><div class="line">    &#125;,</div><div class="line">    //入口文件输出配置</div><div class="line">    output: &#123;</div><div class="line">        path: <span class="string">'dist/js/page'</span>,</div><div class="line">        filename: <span class="string">'[name].js'</span></div><div class="line">    &#125;,</div><div class="line">    module: &#123;</div><div class="line">        //加载器配置</div><div class="line">        loaders: [</div><div class="line">            &#123; <span class="built_in">test</span>: /\.css$/, loader: <span class="string">'style-loader!css-loader'</span> &#125;,</div><div class="line">            &#123; <span class="built_in">test</span>: /\.js$/, loader: <span class="string">'jsx-loader?harmony'</span> &#125;,</div><div class="line">            &#123; <span class="built_in">test</span>: /\.scss$/, loader: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</div><div class="line">            &#123; <span class="built_in">test</span>: /\.(png|jpg)$/, loader: <span class="string">'url-loader?limit=8192'</span>&#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    //其它解决方案配置</div><div class="line">    resolve: &#123;</div><div class="line">        //查找module的话从这里开始查找</div><div class="line">        root: <span class="string">'E:/github/flux-example/src'</span>, //绝对路径</div><div class="line">        //自动扩展文件后缀名，意味着我们require模块可以省略不写后缀名</div><div class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.scss'</span>],</div><div class="line">        //模块别名定义，方便后续直接引用别名，无须多写长长的地址</div><div class="line">        <span class="built_in">alias</span>: &#123;</div><div class="line">            AppStore : <span class="string">'js/stores/AppStores.js'</span>,//后续直接 require(<span class="string">'AppStore'</span>) 即可</div><div class="line">            ActionType : <span class="string">'js/actions/ActionType.js'</span>,</div><div class="line">            AppAction : <span class="string">'js/actions/AppAction.js'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>⑴ plugins 是插件项，这里我们使用了一个 CommonsChunkPlugin 的插件，它用于提取多个入口文件的公共脚本部分，然后生成一个 common.js 来方便多页面之间进行复用。</p>
<p>⑵ entry 是页面入口文件配置，output 是对应输出项配置（即入口文件最终要生成什么名字的文件、存放到哪里），其语法大致为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    entry: &#123;</div><div class="line">        page1: <span class="string">"./page1"</span>,</div><div class="line">        //支持数组形式，将加载数组中的所有模块，但以最后一个模块作为输出</div><div class="line">        page2: [<span class="string">"./entry1"</span>, <span class="string">"./entry2"</span>]</div><div class="line">    &#125;,</div><div class="line">    output: &#123;</div><div class="line">        path: <span class="string">"dist/js/page"</span>,</div><div class="line">        filename: <span class="string">"[name].bundle.js"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该段代码最终会生成一个 page1.bundle.js 和 page2.bundle.js，并存放到 ./dist/js/page 文件夹下。<br>⑶ module.loaders 是最关键的一块配置。它告知 webpack 每一种文件都需要使用什么加载器来处理：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">module: &#123;</div><div class="line">    //加载器配置</div><div class="line">    loaders: [</div><div class="line">        //.css 文件使用 style-loader 和 css-loader 来处理</div><div class="line">        &#123; <span class="built_in">test</span>: /\.css$/, loader: <span class="string">'style-loader!css-loader'</span> &#125;,</div><div class="line">        //.js 文件使用 jsx-loader 来编译处理</div><div class="line">        &#123; <span class="built_in">test</span>: /\.js$/, loader: <span class="string">'jsx-loader?harmony'</span> &#125;,</div><div class="line">        //.scss 文件使用 style-loader、css-loader 和 sass-loader 来编译处理</div><div class="line">        &#123; <span class="built_in">test</span>: /\.scss$/, loader: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</div><div class="line">        //图片文件使用 url-loader 来处理，小于8kb的直接转为base64</div><div class="line">        &#123; <span class="built_in">test</span>: /\.(png|jpg)$/, loader: <span class="string">'url-loader?limit=8192'</span>&#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>⑷ 最后是 resolve 配置，这块很好理解，直接写注释了：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">resolve: &#123;</div><div class="line">    //查找module的话从这里开始查找</div><div class="line">    root: <span class="string">'E:/github/flux-example/src'</span>, //绝对路径</div><div class="line">    //自动扩展文件后缀名，意味着我们require模块可以省略不写后缀名</div><div class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.scss'</span>],</div><div class="line">    //模块别名定义，方便后续直接引用别名，无须多写长长的地址</div><div class="line">    <span class="built_in">alias</span>: &#123;</div><div class="line">        AppStore : <span class="string">'js/stores/AppStores.js'</span>,//后续直接 require(<span class="string">'AppStore'</span>) 即可</div><div class="line">        ActionType : <span class="string">'js/actions/ActionType.js'</span>,</div><div class="line">        AppAction : <span class="string">'js/actions/AppAction.js'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关于 webpack.config.js 更详尽的配置可以参考这里。<a href="http://webpack.github.io/docs/configuration.html" target="_blank" rel="external">http://webpack.github.io/docs/configuration.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/08/04/px、em、rem区别介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/04/px、em、rem区别介绍/" itemprop="url">
                  px、em、rem区别介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-04T10:08:56+08:00">
                2017-08-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="px像素（Pixel）"><a href="#px像素（Pixel）" class="headerlink" title="px像素（Pixel）"></a>px像素（Pixel）</h4><p>相对长度单位。像素px是相对于显示器屏幕分辨率而言的。<br>PX特点</p>
<ol>
<li>IE无法调整那些使用px作为单位的字体大小；</li>
<li>国外的大部分网站能够调整的原因在于其使用了em或rem作为字体单位；</li>
<li>Firefox能够调整px和em，rem，但是96%以上的中国网民使用IE浏览器(或内核)。</li>
</ol>
<h4 id="EM是相对长度单位"><a href="#EM是相对长度单位" class="headerlink" title="EM是相对长度单位"></a>EM是相对长度单位</h4><p>相对于当前对象内文本的字体尺寸。如当前对行内文本的字体尺寸未被人为设置，则相对于浏览器的默认字体尺寸。<br>EM特点</p>
<ol>
<li>em的值并不是固定的；</li>
<li>em会继承父级元素的字体大小。<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">注意：任意浏览器的默认字体高都是16px。所有未经调整的浏览器都符合: 1em=16px。那么12px=0.75em,10px=0.625em。为了简化font-size的换算，需要在css中的body选择器中声明Font-size=62.5%，这就使em值变为 16px*62.5%=10px, 这样12px=1.2em, 10px=1em, 也就是说只需要将你的原来的px数值除以10，然后换上em作为单位就行了。</div><div class="line">所以我们在写CSS的时候，需要注意两点：</div><div class="line">1. body选择器中声明Font-size=62.5%；</div><div class="line">2. 将你的原来的px数值除以10，然后换上em作为单位；</div><div class="line">3. 重新计算那些被放大的字体的em数值。避免字体大小的重复声明。</div><div class="line">也就是避免1.2 * 1.2= 1.44的现象。比如说你在<span class="comment">#content中声明了字体大小为1.2em，那么在声明p的字体大小时就只能是1em，而不是1.2em, 因为此em非彼em，它因继承#content的字体高而变为了1em=12px。</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="rem是CSS3新增的一个相对单位"><a href="#rem是CSS3新增的一个相对单位" class="headerlink" title="rem是CSS3新增的一个相对单位"></a>rem是CSS3新增的一个相对单位</h4><p>这个单位引起了广泛关注。这个单位与em有什么区别呢？区别在于使用rem为元素设定字体大小时，仍然是相对大小，但相对的只是HTML根元素。这个单位可谓集相对大小和绝对大小的优点于一身，通过它既可以做到只修改根元素就成比例地调整所有字体大小，又可以避免字体大小逐层复合的连锁反应。目前，除了IE8及更早版本外，所有浏览器均已支持rem。对于不支持它的浏览器，应对方法也很简单，就是多写一个绝对单位的声明。这些浏览器会忽略用rem设定的字体大小。下面就是一个例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &#123;font-size:14px; font-size:.875rem;&#125;</div><div class="line">注意： 选择使用什么字体单位主要由你的项目来决定，如果你的用户群都使用最新版的浏览器，那推荐使用rem，如果要考虑兼容性，那就使用px,或者两者同时使用。</div></pre></td></tr></table></figure></p>
<p>px 与 rem 的选择？<br>对于只需要适配少部分手机设备，且分辨率对页面影响不大的，使用px即可 。<br>对于需要适配各种移动设备，使用rem，例如只需要适配iPhone和iPad等分辨率差别比较挺大的设备。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/08/04/react踩过的坑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/04/react踩过的坑/" itemprop="url">
                  react 踩过的坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-04T09:13:31+08:00">
                2017-08-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-在JSX的元素中写入内联样式，例如"><a href="#1-在JSX的元素中写入内联样式，例如" class="headerlink" title="1 在JSX的元素中写入内联样式，例如"></a>1 在JSX的元素中写入内联样式，例如</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;div style=&#123;<span class="string">"color:blue"</span>&#125;&gt;&lt;/div&gt;</div><div class="line">报错：warning：Style prop value must be an object  react/style-prop-object</div></pre></td></tr></table></figure>
<p>原因：在React框架的JSX编码格式要求，style必须是一个对象<br>解决方法：除了外部那个表示Javascript语句的花括号外，里面必须再写一个花括号{}包含的对象，例如<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div style=&#123; &#123;  color:“blue”  &#125; &#125;&gt;&lt;/div&gt;，</div></pre></td></tr></table></figure></p>
<p>外部的{ }表示这是Javascript句法，里面的{  }是一个对象</p>
<h4 id="2-遍历数组元素："><a href="#2-遍历数组元素：" class="headerlink" title="2 遍历数组元素："></a>2 遍历数组元素：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var arr=[1,2,3]</div><div class="line">arr.map(<span class="keyword">function</span>(x)&#123;</div><div class="line">  <span class="built_in">return</span> (&lt;div&gt;&lt;/div&gt;);</div><div class="line">&#125;)</div><div class="line">报错：Warning:Each child <span class="keyword">in</span> an array or iterator should have a unique <span class="string">"key"</span> prop. Check the render method of `NavBlock`</div></pre></td></tr></table></figure>
<p>原因：在React中数组遍历返回元素或组件时需加上key属性作为唯一标识<br>解决方法：写成<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var arr=[1,2,3]</div><div class="line">arr.map(<span class="keyword">function</span>(x,i)&#123;</div><div class="line">  <span class="built_in">return</span> (&lt;div key=i&gt;&lt;/div&gt;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h4 id="3-在render-函数中返回时这样写："><a href="#3-在render-函数中返回时这样写：" class="headerlink" title="3 在render()函数中返回时这样写："></a>3 在render()函数中返回时这样写：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">render</span></span>()&#123;</div><div class="line">  <span class="built_in">return</span> &lt;div&gt;&lt;/div&gt;</div><div class="line">        &lt;div&gt;&lt;/div&gt;</div><div class="line">        &lt;div&gt;&lt;/div&gt;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>报错：Adjacent JSX elements must be wrapped in an enclosing tag (75:8)<br>原因：render()函数中返回的所有元素需要包裹在一个外部元素里面<br>解决方法：可改写为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">render</span></span>()&#123;</div><div class="line">  <span class="built_in">return</span>  &lt;section&gt;</div><div class="line">                &lt;div&gt;&lt;/div&gt;</div><div class="line">                &lt;div&gt;&lt;/div&gt;</div><div class="line">                &lt;div&gt;&lt;/div&gt;</div><div class="line">          &lt;/section&gt;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>最后一点—不能写成：（return语句和返回元素不在同一行会被解析器视为返回null导致错误)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">render</span></span>()&#123;</div><div class="line">  <span class="built_in">return</span>  </div><div class="line">       &lt;section&gt;</div><div class="line">          &lt;div&gt;&lt;/div&gt;</div><div class="line">          &lt;div&gt;&lt;/div&gt;</div><div class="line">          &lt;div&gt;&lt;/div&gt;</div><div class="line">       &lt;/section&gt;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/08/03/React生命周期总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/03/React生命周期总结/" itemprop="url">
                  React生命周期总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T20:10:22+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="react生命周期流程"><a href="#react生命周期流程" class="headerlink" title="react生命周期流程"></a>react生命周期流程</h3><h4 id="1-初始化，首次render"><a href="#1-初始化，首次render" class="headerlink" title="1.初始化，首次render"></a>1.初始化，首次render</h4><p>getDefaultProps 方法可以用来设置组件属性的默认值,在组件被建立时候就立即调用</p>
<p>getInitialState 方法用于定义初始状态</p>
<p>componentWillMount只在初始化时候被调用一次</p>
<p>render()</p>
<p>componentDidmount()在子组件也都加载完毕后执行，在RN中就是指组件初始化加载完毕，在react中DOM渲染完成</p>
<h4 id="2-props发生改变时候更新"><a href="#2-props发生改变时候更新" class="headerlink" title="2.props发生改变时候更新"></a>2.props发生改变时候更新</h4><p>componentWillReceiveProps(nextProps)</p>
<p>componentWillReceiveProps方法可以比较this.props和nextProps来看是否发生了变化，然后可以进行setState等操作。<br>注意只要父组件此方法触发，那么子组件也会触发，也就是说父组件更新，子组件也会跟着更新。</p>
<p>shouldComponentUpdate(nextProps, nextState)</p>
<p>shouldComponentUpdate 方法在接收了新的props或state后触发，可以通过返回true或false来控制后面的生命周期流程是否触发。</p>
<p>componentWillUpdate(nextProps, nextState)</p>
<p>componentWillUpdate在props或state改变或shouldComponentUpdate返回true后触发。不可在其中使用setState。<br>render()</p>
<p>重新渲染。</p>
<p>componentDidupdate(prevProps, prevState)</p>
<p>会等子组件也都更新完后才触发。</p>
<h4 id="3-state发生改变时候更新"><a href="#3-state发生改变时候更新" class="headerlink" title="3.state发生改变时候更新"></a>3.state发生改变时候更新</h4><p>shouldComponentUpdate(nextProps, nextState)</p>
<p>shouldComponentUpdate 方法在setState后state发生改变后触发，你可以通过返回true或false来控制后面的生命周期流程是否触发。</p>
<p>componentWillUpdate(nextProps, nextState)</p>
<p>componentWillUpdate在state改变或shouldComponentUpdate返回true后触发。不可在其中使用setState。</p>
<p>render()</p>
<p>重新渲染。</p>
<p>componentDidupdate(prevProps, prevState)</p>
<p>会等子组件也都更新完后才触发。</p>
<p>index作为key是一种反模式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    this.state.data.map(el=&gt;&lt;MyComponent key=&#123;Math.random()&#125; /&gt;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码中MyComponent的key值是用Math.random随机生成的，虽然能够保持其唯一性，但是它的值是随机而不是稳定的，在数组动态改变时会导致数组元素中的每项都重新销毁然后重新创建，有一定的性能开销；另外可能导致一些意想不到的问题出现。所以：key的值要保持稳定且唯一，不能使用random来生成key的值。<br>所以，在不能使用random随机生成key时，我们可以像下面这样用一个全局的localCounter变量来添加稳定唯一的key值。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var <span class="built_in">local</span>Counter = 1;</div><div class="line">this.data.forEach(el=&gt;&#123;</div><div class="line">    el.id = <span class="built_in">local</span>Counter++;</div><div class="line">&#125;);</div><div class="line">//向数组中动态添加元素时，</div><div class="line"><span class="keyword">function</span> createUser(user) &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        ...user,</div><div class="line">        id: <span class="built_in">local</span>Counter++</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="forEach和map和for方法的区别"><a href="#forEach和map和for方法的区别" class="headerlink" title="forEach和map和for方法的区别:"></a>forEach和map和for方法的区别:</h4><p>总结：<br>1、map速度比foreach快<br>2、map会返回一个新数组，不对原数组产生影响,foreach不会返回新数组，<br>3、map因为返回数组所以可以链式操作，foreach不能</p>
<h4 id="为什么更推荐用-map-，而不是-forEach-？"><a href="#为什么更推荐用-map-，而不是-forEach-？" class="headerlink" title="为什么更推荐用.map()，而不是.forEach()？"></a>为什么更推荐用.map()，而不是.forEach()？</h4><p>第一：.map()要比.forEach()执行速度快。虽然我也说过执行速度不是我们需要考虑的主要因素，但是他们都比for()要好用，那肯定要选更优化的一个。<br>第二：.forEach()的返回值并不是array。如果你想用函数式编程写个链式表达式来装个逼，.map()将会是你不二的选择。</p>
<p>来看下面这个例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">var arr = [1, 2, 3];</div><div class="line">console.log(</div><div class="line">    arr.map(<span class="keyword">function</span>(i)&#123;</div><div class="line">        <span class="built_in">return</span> i+i;</div><div class="line">    &#125;)</div><div class="line">    //链式风格</div><div class="line">    .sort()</div><div class="line">);// [2,4,6]</div><div class="line"></div><div class="line">console.log(</div><div class="line">    arr.forEach(<span class="keyword">function</span>(i)&#123;</div><div class="line">        <span class="built_in">return</span> i+i;</div><div class="line">    &#125;)</div><div class="line">    //接不起来，断了</div><div class="line">    .sort()</div><div class="line">); // TypeError: Cannot <span class="built_in">read</span> property <span class="string">'sort'</span> of undefined</div><div class="line"></div><div class="line">最后，感谢大家耐心的阅读，排个序</div><div class="line"></div><div class="line">.map() &gt; .forEach() &gt; <span class="keyword">for</span>()</div></pre></td></tr></table></figure></p>
<p>区别：map的回调函数中支持return返回值；return的是啥，就相当于返回一个新数组（并不影响原来的数组，只是相当于把原数组克隆一份，把克隆的这一份的数组中的对应项改变了）；<br>不管是forEach还是map 都支持第二个参数值，第二个参数的意思是把匿名回调函数中的this进行修改。</p>
<p>es5的写法： bind可以改变this的指向<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">componentDidmount: <span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">    alert(<span class="string">'did'</span>);</div><div class="line">    window.setInterval(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">        this.setState(&#123;</div><div class="line">            fontSize: <span class="string">'44px'</span></div><div class="line">        &#125;)</div><div class="line">    &#125;, <span class="built_in">bind</span>(this), 1000);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/07/28/跨域问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/28/跨域问题/" itemprop="url">
                  跨域
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-28T14:47:23+08:00">
                2017-07-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="document-domain-子域名跨域"><a href="#document-domain-子域名跨域" class="headerlink" title="document.domain 子域名跨域"></a>document.domain 子域名跨域</h4><p>这跨域个方法主要适用于 ajax跨子域，比如在 a.takozhang.cn 中使用ajax调用 takozhang.cn 中的接口时。</p>
<ol>
<li>在被访问接口的服务器中，新建一个proxy.html文件，里面的代码是：<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">  document.domain = <span class="string">'takozhang.cn'</span></div><div class="line">&lt;/script&gt;</div><div class="line">&lt;script src = <span class="string">'jquery.js'</span>&gt;&lt;/script&gt;</div><div class="line">2. 在调用页面使用一个隐藏的iframe，地址指向proxy.html，代码如下：</div><div class="line">&lt;iframe src=<span class="string">"http://takozhang.cn/proxy.html"</span> id=<span class="string">"proxy"</span>&gt;&lt;/iframe&gt;</div><div class="line">3. 在a.takozhang.cn服务器中进行ajax发送请求的时候，代码如下：</div><div class="line">var iframe = document.getElementById(<span class="string">'proxy'</span>).contentWindow;</div><div class="line">iframe.window.JQuery.ajax(&#123;</div><div class="line">  url: <span class="string">'takozhang.cn/php/index.php'</span>,</div><div class="line">  method: <span class="string">'post'</span>,</div><div class="line">  success: <span class="keyword">function</span>(data)&#123;&#125;,</div><div class="line">  error: <span class="keyword">function</span>(err)&#123;&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h4><p>基本可以适用于任何场景</p>
<ol>
<li>客户端动态创建script标签，并利用src属性去向服务端获取数据 src=”www.a.com/index.php?callback=fn”,切记一定要在后面加上一个callback回调函数</li>
<li>服务端会将请求的json数据放在这个你指定的回调函数里作为参数返回回来，如服务器会返回 fn(data),</li>
<li>客户端写好回调函数的实现，处理数据。<br>4.但是jsonp是存在着一定的风险的,就是你用jsonp, 然后黑客给你发了一张图片。图片的src=”xxx/xxx/xx.jsonp?data=sxx&amp;name=xxxx”,  你点击后。直接请求成功。 。这个就是CSRF 。跨域请求伪造<br>还有一个比较典型的安全问题、XSS 。跨脚本注入js</li>
</ol>
<h4 id="window-name-也就是-iframe"><a href="#window-name-也就是-iframe" class="headerlink" title="window.name 也就是 iframe"></a>window.name 也就是 iframe</h4><p>只用于两个完全不同源的域，比如www.a.com   www.b.com<br>window.name属性有个特征：即在一个窗口(window)的生命周期内,窗口载入的所有的页面都是共享一个window.name</p>
<ol>
<li><p>在www.a.com的服务器中创建一个iframe，并引入www.b.com，代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">  var inf=document.createElement(<span class="string">"iframe"</span>);       //创建iframe</div><div class="line">  inf.src=<span class="string">"http://www.b.com/index.html"</span>+<span class="string">"?h=5"</span>  //加载数据页www.b.com/index.html的同时携带参数h=5</div><div class="line">  var body=document.getElementsByTagName(<span class="string">"body"</span>)[0];</div><div class="line">  body.appendChild(inf);                          //引入iframe</div><div class="line"></div><div class="line">  inf.onload=<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">    inf.src=<span class="string">'http://www.a.com/index.html'</span>       //iframe加载完成，加载www.a.com域下边的空白页index.html</div><div class="line">    console.log(inf.contentWindow.name)        //输出window.name中的数据</div><div class="line">    body.removeChild(inf)                      //清除iframe</div><div class="line">  &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>在www.b.com中的index.html中进行ajax，并把返回值通过window.name储存，代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var str=window.location.href.substr(-1,1);      //获取url中携带的参数值</div><div class="line">$.ajax(&#123;</div><div class="line">    <span class="built_in">type</span>:<span class="string">"post"</span>,</div><div class="line">    url:<span class="string">"http://www.b.com/index.php"</span>+<span class="string">"?m="</span>+str, //通过ajax将查询参数传给php页面</div><div class="line">    success:<span class="keyword">function</span>(res)&#123;</div><div class="line">        window.name=res                         //将接收到的查询数据赋值给window.name</div><div class="line">    &#125;,</div><div class="line">    error:<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">        window.name=<span class="string">'error'</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>整体过程就是：a服务器的页面中中创建一个iframe，iframe引入b服务器中进行ajax的页面，该页面ajax之后将返回值赋值给window.name，<br>a服务器页面监听iframe事件的加载完成，再将iframe地址指向a服务器中的某个空白页面，然后读取iframe的window.name。</p>
<h4 id="window-postMessage-message-targetOrigin"><a href="#window-postMessage-message-targetOrigin" class="headerlink" title="window.postMessage(message,targetOrigin)"></a>window.postMessage(message,targetOrigin)</h4><p>这个方法是html5新引进的特性，可以使用它来向其它的window对象发送消息，<br>无论这个window对象是属于同源或不同源，目前IE8+、FireFox、Chrome、Opera等浏览器都已经支持window.postMessage方法。</p>
<p>在父页面中嵌入子页面，通过postMessage发送数据。parent.com/index.html中的代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;iframe id=<span class="string">"ifr"</span> src=<span class="string">"child.com/index.html"</span>&gt;&lt;/iframe&gt;</div><div class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</div><div class="line">window.onload = <span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">  var ifr = document.getElementById(<span class="string">'ifr'</span>);</div><div class="line">  var targetOrigin = <span class="string">'http://child.com'</span>;</div><div class="line">  // 若写成<span class="string">'http://child.com/c/proxy.html'</span>效果一样</div><div class="line">  // 若写成<span class="string">'http://c.com'</span>就不会执行postMessage了</div><div class="line">  ifr.contentWindow.postMessage(<span class="string">'I was there!'</span>, targetOrigin);</div><div class="line">&#125;;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>在子页面中通过message事件监听父页面发送来的消息并显示。child.com/index.html中的代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</div><div class="line">window.addEventListener(<span class="string">'message'</span>, <span class="keyword">function</span>(event)&#123;</div><div class="line">  // 通过origin属性判断消息来源地址</div><div class="line">  <span class="keyword">if</span> (event.origin == <span class="string">'http://parent.com'</span>) &#123;</div><div class="line">      alert(event.data);    // 弹出<span class="string">"I was there!"</span></div><div class="line">      alert(event.source);</div><div class="line">      // 对parent.com、index.html中window对象的引用</div><div class="line">      // 但由于同源策略，这里event.source不可以访问window对象</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>主要是用来传递信息，父页面使用window.postMessage(),子页面使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">window.addEventListener(<span class="string">'message'</span>,<span class="keyword">function</span>(event)&#123;&#125;)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhangyuki.github.io/2017/07/10/js中toFixed精度问题的解决办法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="玉英（小丸子）">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="玉英博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/10/js中toFixed精度问题的解决办法/" itemprop="url">
                  js中toFixed精度问题的解决办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-10T17:34:06+08:00">
                2017-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在做项目的时候，遇到了有四舍五入保留两位的需求，当时不假思索的直接使用了js原生的toFixed方法，结果问题百出。有以下几点问题：</p>
<h5 id="1-四舍五入并不是真正的四舍五入"><a href="#1-四舍五入并不是真正的四舍五入" class="headerlink" title="1.四舍五入并不是真正的四舍五入"></a>1.四舍五入并不是真正的四舍五入</h5><p>这个问题是在测试阶段我们的测试人员提出来的。一开始我也很吃惊，结果待我在控制台试了一些数据之后，我懵逼了,我一直在用的toFixed方法竟然有问题，我竟然糊涂的用它做了很多事！以下是我在chrome上的结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1.35.toFixed(1) // 1.4 正确</div><div class="line">1.335.toFixed(2) // 1.33  错误</div><div class="line">1.3335.toFixed(3) // 1.333 错误</div><div class="line">1.33335.toFixed(4) // 1.3334 正确</div><div class="line">1.333335.toFixed(5)  // 1.33333 错误</div><div class="line">1.3333335.toFixed(6) // 1.333333 错误</div></pre></td></tr></table></figure>
<p>果然有问题，只能网上找资料了，结果又发现同样是上面的一段代码，在IE下又小同大异，以下是IE上的结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1.35.toFixed(1) // 1.4 正确</div><div class="line">1.335.toFixed(2) // 1.34  正确</div><div class="line">1.3335.toFixed(3) // 1.334 正确</div><div class="line">1.33335.toFixed(4) // 1.3334 正确</div><div class="line">1.333335.toFixed(5)  // 1.33334 正确</div><div class="line">1.3333335.toFixed(6) // 1.333334 正确</div></pre></td></tr></table></figure></p>
<p>果然IE才是爸爸。难道是浏览器兼容性问题？兼容性问题难道不应该是出在IE中吗？既然找到问题所在，就好下手。我的办法是把要四舍五入的后一位单独拎出来单独判断。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> result = number.toString();</div><div class="line">const arr = result.split(<span class="string">'.'</span>);</div><div class="line">const <span class="built_in">integer</span> = arr[0];</div><div class="line">const decimal = arr[1];</div><div class="line">result = <span class="built_in">integer</span> + <span class="string">'.'</span> + decimal.substr(0, n);</div><div class="line">const last = decimal.substr(n, 1);</div><div class="line"></div><div class="line">// 四舍五入，转换为整数再处理，避免浮点数精度的损失</div><div class="line"><span class="keyword">if</span> (parseInt(last, 10) &gt;= 5) &#123;</div><div class="line">const x = Math.pow(10, n);</div><div class="line">result = ((parseFloat(result) * x) + 1) / x;</div><div class="line">result = result.toFixed(n);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">return</span> result;</div></pre></td></tr></table></figure></p>
<p>自己测了几遍，貌似没什么问题，OK~</p>
<h5 id="2-计算机二进制编码导致的精度问题"><a href="#2-计算机二进制编码导致的精度问题" class="headerlink" title="2.计算机二进制编码导致的精度问题"></a>2.计算机二进制编码导致的精度问题</h5><p>没过多久，测试又提出来页面报错了~~ 心塞啊，怎么可能报错呢？自己debugger，发现页面中的js进了死循环。很明显问题出在toFixed中回调了toFixed，结果没有走出来，继续debugger，又有了进人的发现。以下是控制台测试：</p>
<p>console.log(2.115 <em> 100) // 211.50000000000003<br>console.log(2.0115 </em> 1000) // 2011.4999999999998<br>能告诉我是在闹哪样？好吧，我猜到了，肯定是计算机的进制问题。既然你一直进入循环，我就手动把你拉出来。</p>
<p>result = (Math.round((parseFloat(result)) * x) + 1) / x;<br>强制四舍五入取整，不会进死循环了！</p>
<p>以下是全部代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">// toFixed兼容方法</div><div class="line">Number.prototype.toFixed = <span class="keyword">function</span> (n) &#123;</div><div class="line">    <span class="keyword">if</span> (n &gt; 20 || n &lt; 0) &#123;</div><div class="line">        throw new RangeError(<span class="string">'toFixed() digits argument must be between 0 and 20'</span>);</div><div class="line">    &#125;</div><div class="line">    const number = this;</div><div class="line">    <span class="keyword">if</span> (isNaN(number) || number &gt;= Math.pow(10, 21)) &#123;</div><div class="line">        <span class="built_in">return</span> number.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (typeof (n) == <span class="string">'undefined'</span> || n == 0) &#123;</div><div class="line">        <span class="built_in">return</span> (Math.round(number)).toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">let</span> result = number.toString();</div><div class="line">    const arr = result.split(<span class="string">'.'</span>);</div><div class="line"></div><div class="line">    // 整数的情况</div><div class="line">    <span class="keyword">if</span> (arr.length &lt; 2) &#123;</div><div class="line">        result += <span class="string">'.'</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; n; i += 1) &#123;</div><div class="line">            result += <span class="string">'0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    const <span class="built_in">integer</span> = arr[0];</div><div class="line">    const decimal = arr[1];</div><div class="line">    <span class="keyword">if</span> (decimal.length == n) &#123;</div><div class="line">        <span class="built_in">return</span> result;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (decimal.length &lt; n) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; n - decimal.length; i += 1) &#123;</div><div class="line">            result += <span class="string">'0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> result;</div><div class="line">    &#125;</div><div class="line">    result = <span class="built_in">integer</span> + <span class="string">'.'</span> + decimal.substr(0, n);</div><div class="line">    const last = decimal.substr(n, 1);</div><div class="line"></div><div class="line">    // 四舍五入，转换为整数再处理，避免浮点数精度的损失</div><div class="line">    <span class="keyword">if</span> (parseInt(last, 10) &gt;= 5) &#123;</div><div class="line">        const x = Math.pow(10, n);</div><div class="line">        result = (Math.round((parseFloat(result) * x)) + 1) / x;</div><div class="line">        result = result.toFixed(n);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">return</span> result;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://imgsrc.baidu.com/forum/w%3D580/sign=aa09a14c8244ebf86d716437e9f8d736/ea6dc811728b4710787b6583c6cec3fdfd032371.jpg"
               alt="玉英（小丸子）" />
          <p class="site-author-name" itemprop="name">玉英（小丸子）</p>
           
              <p class="site-description motion-element" itemprop="description">将来的你，一定会感谢现在拼命努力的自己</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhangyuki" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">玉英（小丸子）</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
